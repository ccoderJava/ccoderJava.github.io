(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{466:function(s,a,t){"use strict";t.r(a);var r=t(9),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("hello，大家好，我是聪聪。")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("今天在本地启动一些项目时，无法连接公司Redis服务。\n那就在本地"),t("code",[s._v("portainer")]),s._v("上拉起整个Redis集群")]),s._v(" "),t("p",[s._v("对了 ，portainer是一个可视化的docker操作页面，提供应用模板快速部署、镜像网络数据卷基本操作、事件日志显示、容器console操作、swarm集群和服务集群管理。同时还提供用户权限、租户管理。\n当然可以链接到云服务上进行镜像管理和gitlab私服仓库管理。\n"),t("img",{attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-11-135430.png",alt:"image.png"}}),s._v("\n管理正在运行的容器列表：\n"),t("img",{attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-11-135439.png",alt:"image.png"}})]),s._v(" "),t("h3",{attrs:{id:"_1-redis-集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-redis-集群"}},[s._v("#")]),s._v(" 1.Redis 集群")]),s._v(" "),t("p",[s._v("一主二从三哨兵 (1:master  2:slave 3:sentinel)\n"),t("img",{attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-11-135445.png",alt:"image.png"}})]),s._v(" "),t("h3",{attrs:{id:"_2-docker-compliance文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker-compliance文件"}},[s._v("#")]),s._v(" 2.docker-compliance文件")]),s._v(" "),t("h4",{attrs:{id:"_2-1-创建一主二从"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-创建一主二从"}},[s._v("#")]),s._v(" 2.1 创建一主二从")]),s._v(" "),t("p",[s._v("先创建一个一主二从的Redis集群。")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\nservices"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  master"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis\n    container_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master\n    command"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("requirepass redis_pwd  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("masterauth redis_pwd\n    ports"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6380")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n  slave1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis\n    container_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slave"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    ports"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6381")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n    command"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("  redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("slaveof redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("requirepass redis_pwd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("masterauth redis_pwd\n  slave2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis\n    container_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slave"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    ports"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6382")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n    command"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("slaveof redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("requirepass redis_pwd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("masterauth redis_pwd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("注意")]),s._v(" "),t("ul",[t("li",[s._v("这里面设置了"),t("code",[s._v("master")]),s._v("节点密码为"),t("code",[s._v("redis_pwd")]),s._v("，那么同样也需要将slave进行同步密码masterauth")]),s._v(" "),t("li",[s._v("当master进行故障转移时，slave从节点也会变成master，master变成slave，因此在当前master中也需要携带masterauth参数。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-11-135319.png",alt:"image.png"}})]),s._v(" "),t("h4",{attrs:{id:"_2-2-创建一个网桥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-创建一个网桥"}},[s._v("#")]),s._v(" 2.2 创建一个网桥")]),s._v(" "),t("ul",[t("li",[s._v("可以通过"),t("code",[s._v("docker network create")]),s._v("名称创建一个"),t("code",[s._v("docker-sentinel")]),s._v("网络")]),s._v(" "),t("li",[s._v("通过portainer 中"),t("code",[s._v("network")]),s._v("页面创建"),t("code",[s._v("docker-sentinel")]),s._v("网络，后续哨兵也需要添加到该网桥中来。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-11-135333.png",alt:"image.png"}})]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Name")]),s._v(" network名称")]),s._v(" "),t("li",[t("code",[s._v("Driver")]),s._v("docker网络驱动类型，这里我们选择bridge ，容器之间需要进行通信。\n"),t("ul",[t("li",[t("code",[s._v("host")]),s._v(": 使用docker宿主机网络")]),s._v(" "),t("li",[t("code",[s._v("bridge")]),s._v(": 该网络支持在"),t("strong",[s._v("同一个宿主机")]),s._v("上的各个容器实例之间的通信。bridge网络是一个独立的网络空间，在网络空间内部的各个容器实例能够直接通信。")]),s._v(" "),t("li",[t("code",[s._v("none")]),s._v(": 是一个完全隔离的自治网络，甚至与Docker宿主机的网络都不通，必须手工配置网卡后才能够使用。加入到该网络的容器实例，往往要在后续设置中加入到其他的第三方网络。")]),s._v(" "),t("li",[t("code",[s._v("overlay")]),s._v("：该类型的网络适用于"),t("strong",[s._v("Docker宿主机集群")]),s._v("中的各个独立的容器实例之间通信。")]),s._v(" "),t("li",[t("code",[s._v("macvlan")]),s._v("：该类型的网络适用于容器实例需要与宿主机的MAC地址直接通信，无需端口映射，也无需NAT，容器实例的eth0直接与宿主机的物理网卡通信。容器实例可以被赋予公共IP，并从宿主机外部直接访问。")])])]),s._v(" "),t("li",[t("code",[s._v("Driver options")]),s._v(": 上面network配置的相关参数")]),s._v(" "),t("li",[t("code",[s._v("IPv4 Network configuration")]),s._v("：定义IPv4范围、子网、网关和需要过滤的IP。如果此处未输入任何信息，Docker将自动分配IPv4范围。")]),s._v(" "),t("li",[t("code",[s._v("IPv6 Network configuration")]),s._v("：同理定义IPv6范围、子网、网关等信息。为空则自动分配。")]),s._v(" "),t("li",[t("code",[s._v("Labels")]),s._v("给网络添加标签")]),s._v(" "),t("li",[t("code",[s._v("Isolated network")]),s._v("：该选项可将在此网络中创建的任何容器仅隔离到此网络，而不具有入站或出站连接。")]),s._v(" "),t("li",[t("code",[s._v("Enable manual container attachment")]),s._v("：允许用户通过网络访问到正在运行的容器")])]),s._v(" "),t("p",[s._v("其余配置都可以选择默认的：子网、网关都可以采用默认的，遵从portainer自动分配。\n注意：")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("Enable manual container attachment")]),s._v("配置需要开启为true。可以在外部访问到正在运行的容器。")])]),s._v(" "),t("p",[s._v("参考"),t("a",{attrs:{href:"https://docs.portainer.io/user/docker/networks/add",target:"_blank",rel:"noopener noreferrer"}},[s._v("Add a new network"),t("OutboundLink")],1)]),s._v(" "),t("h4",{attrs:{id:"_2-3-将redis集群和网络进行关联"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-将redis集群和网络进行关联"}},[s._v("#")]),s._v(" 2.3 将redis集群和网络进行关联")]),s._v(" "),t("p",[s._v("可以在上面"),t("code",[s._v("docker-compliance")]),s._v("中进行设定该集群所属网络，也可以使用自动创建的网络，也可以手动创建网络并将集群进行绑定。\n上面已经创建了网络，这里进行绑定。\n"),t("img",{attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-11-135342.png",alt:"image.png"}})]),s._v(" "),t("h4",{attrs:{id:"_2-4-创建哨兵"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-创建哨兵"}},[s._v("#")]),s._v(" 2.4 创建哨兵")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\nservices"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  sentinel1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis\n    container_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    ports"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),s._v("\n    command"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sentinel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n    volumes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker_data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n  sentinel2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis\n    container_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    ports"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26380")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),s._v("\n    command"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sentinel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n    volumes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker_data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n  sentinel3"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis\n    container_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    ports"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26381")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),s._v("\n    command"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sentinel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n    volumes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker_data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sentinel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\nnetworks"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    external"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sentinel\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("volumes")]),s._v("重写了宿主机和容器之间的映射关系，这里可以将所有的Redis配置集中管理。")]),s._v(" "),t("li",[s._v("选择加入一个网络"),t("code",[s._v("redis-sentinel")]),s._v("，将哨兵加入到上述Redis集群中。")])]),s._v(" "),t("p",[s._v("在上述"),t("code",[s._v("/opt/docker_data/redis/sentinel")]),s._v("目录中创建一个哨兵文件，并且添加以下配置：")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[s._v("port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),s._v("\ndir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp\nsentinel monitor mymaster "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".80")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nsentinel auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pass mymaster redis_pwd\nsentinel down"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("after"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("milliseconds mymaster "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),s._v("\nsentinel parallel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("syncs mymaster "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nsentinel failover"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout mymaster "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180000")]),s._v("\nsentinel deny"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scripts"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("reconfig yes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("注意：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("192.168.80.1")]),s._v("是上面创建Redis集群时master节点对应的网关IP。可以直接填写网桥的网关IP。")]),s._v(" "),t("li",[t("code",[s._v("auth-pass mymaster redis_pwd")]),s._v("这里也需要设置Master和Slave 访问密码")]),s._v(" "),t("li",[s._v("主节点名称为"),t("code",[s._v("mymaster")])])]),s._v(" "),t("p",[s._v("在该目录下，将哨兵配置文件赋值三份")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" sentinel.conf sentinel1.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" sentinel.conf sentinel2.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" sentinel.conf sentinel3.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-11-135347.png",alt:"image.png"}})]),s._v(" "),t("p",[s._v("重启上面创建的三个sentinel集群。")]),s._v(" "),t("h4",{attrs:{id:"_2-5-验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-验证"}},[s._v("#")]),s._v(" 2.5 验证")]),s._v(" "),t("ul",[t("li",[s._v("进入Master节点。 确认其余两个slave节点是否已经连接上。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-11-135350.png",alt:"image.png"}})]),s._v(" "),t("ul",[t("li",[s._v("进入其中一个sentinel容器，确保master、2salve、2sentinel 均在线。")])]),s._v(" "),t("h3",{attrs:{id:"_3-npm配置域名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-npm配置域名"}},[s._v("#")]),s._v(" 3.npm配置域名")]),s._v(" "),t("p",[s._v("npm(Nginx proxy manage)进行配置二级域名反向代理。\n"),t("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-11-135357.png",alt:"image.png"}})]),s._v(" "),t("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-11-135849.png",alt:"image.png"}}),s._v("\n这里可以配置多个Redis的节点耳机域名。\n"),t("ul",[t("li",[s._v("使用Medis 进行连接，可以查看服务器中"),t("code",[s._v("redis mode")]),s._v("为 sentinel哨兵模式。")])]),s._v(" "),t("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-11-135520.png",alt:"Redis 服务器连接信息"}}),s._v(" "),t("p",[s._v("现在就可以"),t("code",[s._v("HA(High Avaliable)模式")]),s._v("高可用愉快的玩耍啦。")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("了解更多内容，可以关注我的微信公众号，更多首发文章。\n"),t("img",{attrs:{src:"https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-28-064228.bmp",alt:"wechat"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);