<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《领域驱动设计》之软件复杂度 | 聪聪碎碎念</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="./favicon.ico">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-40YT5YJMBG" async="true"></script>
    <script> window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-40YT5YJMBG');</script>
    <script>var _hmt = _hmt || [];
               (function() {
                 var hm = document.createElement("script");
                 hm.src = "https://hm.baidu.com/hm.js?921719b1f1d6a98cb84343b54b11c7dd";
                 var s = document.getElementsByTagName("script")[0];
                 s.parentNode.insertBefore(hm, s);
               })();</script>
    <link rel="alternate" type="application/rss+xml" href="http://www.ccoder.cc/rss.xml" title="聪聪碎碎念 RSS Feed">
    <meta name="description" content="hello，大家好，我是聪聪。

最近闲暇时间看了下张逸的《领域驱动设计》，书中对于软件复杂度包含的一些内容，让我有些同感。目前接触的一些系统中都会有一些技术债、坏味道在其中。

那么就在这里结合自身现有的一些系统设计，做一个随笔记录。

1.复杂系统

什么是复杂的系统呢？
> 由大量相互作用的部分组成的系统。与整个系统比起来，这些组成部分相对简单，没有中央控制，组成部 ...">
    <meta name="Keywords" content="ccoderJava,ccoder,聪聪的日志">
    
    <link rel="preload" href="/assets/css/0.styles.011b59ea.css" as="style"><link rel="preload" href="/assets/js/app.7b778307.js" as="script"><link rel="preload" href="/assets/js/7.97c4f7f9.js" as="script"><link rel="preload" href="/assets/js/3.42bf2e6b.js" as="script"><link rel="preload" href="/assets/js/20.cae0dcf4.js" as="script"><link rel="prefetch" href="/assets/js/10.531f4524.js"><link rel="prefetch" href="/assets/js/11.58aec4b6.js"><link rel="prefetch" href="/assets/js/12.24549026.js"><link rel="prefetch" href="/assets/js/13.7ca212e0.js"><link rel="prefetch" href="/assets/js/14.866271cf.js"><link rel="prefetch" href="/assets/js/15.b4f89f2c.js"><link rel="prefetch" href="/assets/js/16.554ad734.js"><link rel="prefetch" href="/assets/js/17.4c4bb8be.js"><link rel="prefetch" href="/assets/js/18.5b4cbac5.js"><link rel="prefetch" href="/assets/js/19.5523123d.js"><link rel="prefetch" href="/assets/js/21.6460c15b.js"><link rel="prefetch" href="/assets/js/22.1c7d6f32.js"><link rel="prefetch" href="/assets/js/23.13195399.js"><link rel="prefetch" href="/assets/js/24.41b250c4.js"><link rel="prefetch" href="/assets/js/25.95a8c30c.js"><link rel="prefetch" href="/assets/js/26.1c1ea10b.js"><link rel="prefetch" href="/assets/js/27.e3ff3995.js"><link rel="prefetch" href="/assets/js/28.4932824c.js"><link rel="prefetch" href="/assets/js/29.f7d5698d.js"><link rel="prefetch" href="/assets/js/30.93fd6aba.js"><link rel="prefetch" href="/assets/js/31.81151b77.js"><link rel="prefetch" href="/assets/js/32.6d8a4e2b.js"><link rel="prefetch" href="/assets/js/33.ed83d4b8.js"><link rel="prefetch" href="/assets/js/34.03576be8.js"><link rel="prefetch" href="/assets/js/35.65084bb6.js"><link rel="prefetch" href="/assets/js/36.0759daae.js"><link rel="prefetch" href="/assets/js/37.37caabf6.js"><link rel="prefetch" href="/assets/js/38.515763e2.js"><link rel="prefetch" href="/assets/js/39.04dd744d.js"><link rel="prefetch" href="/assets/js/4.a4c65c8f.js"><link rel="prefetch" href="/assets/js/40.0624546c.js"><link rel="prefetch" href="/assets/js/41.5bea29b8.js"><link rel="prefetch" href="/assets/js/42.2c1415b0.js"><link rel="prefetch" href="/assets/js/43.3d05244b.js"><link rel="prefetch" href="/assets/js/44.f3456612.js"><link rel="prefetch" href="/assets/js/45.772c60b6.js"><link rel="prefetch" href="/assets/js/46.ba97a1d0.js"><link rel="prefetch" href="/assets/js/47.f3ba6614.js"><link rel="prefetch" href="/assets/js/48.db14f4af.js"><link rel="prefetch" href="/assets/js/49.303ece5e.js"><link rel="prefetch" href="/assets/js/5.83f49348.js"><link rel="prefetch" href="/assets/js/50.48f0bbe8.js"><link rel="prefetch" href="/assets/js/51.fc7e32ab.js"><link rel="prefetch" href="/assets/js/52.da0c4e96.js"><link rel="prefetch" href="/assets/js/53.315f2104.js"><link rel="prefetch" href="/assets/js/54.2faba730.js"><link rel="prefetch" href="/assets/js/55.178970d9.js"><link rel="prefetch" href="/assets/js/6.80737f31.js"><link rel="prefetch" href="/assets/js/8.871b00b2.js"><link rel="prefetch" href="/assets/js/9.da852c59.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.a832fb5e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.011b59ea.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">聪聪碎碎念 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">文章</a></li><li class="nav-item"><a href="/notes/" class="nav-link">随笔</a></li><li class="nav-item"><a href="/tag/" class="nav-link">标签</a></li><li class="nav-item"><a href="https://ccoderjava.github.io/chencong_Java Development Engineer_5 years.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">个人简历</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">聪聪碎碎念 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">文章</a></li><li class="mobile-nav-item"><a href="/notes/" class="nav-link">随笔</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">标签</a></li><li class="mobile-nav-item"><a href="https://ccoderjava.github.io/chencong_Java Development Engineer_5 years.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">个人简历</a></li> <li class="mobile-nav-item"><a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        《领域驱动设计》之软件复杂度
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">聪聪</span> <!----></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2022-08-08T11:13:36.000Z">
      2022-08-08 11:13:36
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/DDD" data-v-42ccfcd5><span data-v-42ccfcd5>DDD</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/领域驱动" data-v-42ccfcd5><span data-v-42ccfcd5>领域驱动</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>hello，大家好，我是聪聪。</p> <hr> <p>最近闲暇时间看了下张逸的《领域驱动设计》，书中对于软件复杂度包含的一些内容，让我有些同感。目前接触的一些系统中都会有一些<code>技术债</code>、<code>坏味道</code>在其中。</p> <p>那么就在这里结合自身现有的一些系统设计，做一个随笔记录。</p> <h3 id="_1-复杂系统"><a href="#_1-复杂系统" class="header-anchor">#</a> 1.复杂系统</h3> <p>什么是复杂的系统呢？</p> <blockquote><p>由大量相互作用的部分组成的系统。与整个系统比起来，这些组成部分相对简单，没有中央控制，组成部分之间没有全局性通信，并且组成部分的相互作用导致了复杂行为。</p></blockquote> <p>这样的描述可以引入目前被大家进津津乐道的<code>微服务架构</code>，<code>云原生Service Mesh</code>等等，专注于单一职责与功能的小型模块，利用模块化的方式组合出复杂的大型应用程序，各功能模块使用与语言无关的API进行相互通信。</p> <p>根据上述对于<code>复杂系统</code>的定义，可以将其划分到不同职能模块的微服务中，也可以对于单一系统的细粒度理解。</p> <p>函数、类、模块、组件和服务等，这些都是构成一个复杂系统元素。这些相对简单的元素之间的作用却导致了软件系统的复杂行为，从而提升软件系统的复杂度。</p> <p>可以从<code>理解能力维度</code>和<code>预测能力维度</code>两个方面来理解分析软件的复杂成因：</p> <ul><li><strong>理解能力维度</strong>：
<ul><li>简单的 Simple</li> <li>复杂的 Complicated</li></ul></li> <li><strong>预测能力维度</strong>：
<ul><li>有序的 Ordered</li> <li>复杂的 Complex</li> <li>混沌的 Chaotic</li></ul></li></ul> <p>上述两个方面都蕴含了<code>复杂</code>，但是前者相对简单，可以理解为软件的被理解程度，从简单到复杂的进阶。</p> <p>后者是与有序相对的，包含了软件的发展规律难以预测，是无序的，可以将其理解为复杂难测。</p> <p>在<code>预测能力维度</code>中混沌才是最高层次的复杂，压根就不可预测，可以理解为业务上理解、梳理复杂难以理解，业务发展上无序且快速。</p> <p>那么，在剖析软件系统的复杂度时，我们可以从<code>理解能力</code>和<code>预测能力</code>两个维度去探索复杂度的成因。</p> <h3 id="_2-理解能力"><a href="#_2-理解能力" class="header-anchor">#</a> 2.理解能力</h3> <p>是什么阻碍了你的理解能力呢？是陌生而产生的畏惧，还是庞大的规模产生的恐惧。</p> <p>当项目组新来同学，需要快速理解整个项目架构、业务形态时，是否会迷失在错综复杂的系统调用、相互依赖的业务矩阵当中？</p> <p>就像你来到一个陌生城市旅游时，是否会因为城市错综复杂的交通体系而迷失自我，倘若这座城市就是一个乡郊野外的村落，只有几间房屋和一条南北贯穿的街道，抬头便能将整个村落尽收眼底，你还会产生迷失之感吗？</p> <p>因此，影响理解能力的第一要素便是：<code>规模</code>。</p> <h4 id="_2-1-规模"><a href="#_2-1-规模" class="header-anchor">#</a> 2.1 规模</h4> <p>那么软件系统的规模是你我能够决定的吗？</p> <p>当然不能，当业务高速发展，需求呈线性增长时，需求就像树木那样生长，一颗小树也会成为参天大树，只有到达某个时间节点时，才会趋于稳定。</p> <p>当需求呈线性增长时，为了完成实现这些需求功能点时，软件系统的规模也会以近似的速度快速增长。</p> <p>当然系统规模的快速扩张，不仅仅取决于需求的数量增长，还有需求功能点之间的依赖关系。需求不会独立存在，彼此之间相互影响、相互依赖，修改便会牵一发东全身。</p> <ul><li>函数方法存在副作用，调用时可能对函数方法的返回结果做了隐含的假设。</li> <li>类的职责繁多，违背了单一职责原则。导致后续开发人员不敢轻易修改，同时也不情况修改会影响到哪些模块，持续熵增，</li> <li>热点代码频繁改动，职责不单一，逻辑层层包裹，没有清洗的边界划分。</li> <li>存在隐藏bug，诱发条件具备时便会引起雪崩式调用链瘫痪。</li> <li>业务场景包含了过多例外场景，每种例外场景存在不同的处理方式。</li> <li>同步逻辑、异步逻辑相互纠缠，无法清晰明了预知程序执行顺序。</li></ul> <p>随着软件规模的扩展，复杂度也在增长，这种增长非线性的，而是呈现更为陡峭的指数级增长，这实际上就是我们常说的软件的熵在产生副作用。我们无法规避熵增所带来的重击，软件的熵增可以理解为一个系统<code>无序</code>总量，当软件中无序增加时，便是我们常说的<code>软件在腐烂</code>。</p> <p>为什么我们无法避免软件熵增呢？</p> <p>源于我们构建软件时<strong>无法避免技术债</strong>，无论当前架构设计多么合理，技术决策多么优秀，随着软件的演进均会变得不堪一击，区别在于技术债多与少，以及后续利息有多高。</p> <ul><li>抛弃就得系统，丢弃历史技术债，重新设计一套符合现在业务架构决策的系统，但是必须背负新旧系统同时运行的负担、同时旧系统迁移所带来的成本。可能这就是后人面对<code>屎山</code>一样的设计时常说的说的<code>历史原因所致</code>。</li> <li>需要花费大量尽力、寻找熟悉系统人员进行评估、&quot;设计&quot;系统，在开发阶段详细确认所有系统影响点。由于经手人员加多、业务迭代较快，这份详细系统设计也仅仅是“熟悉系统人员”的一份回忆录而已。这也是也分技术债，但更多的是组织架构层面的。</li> <li>不同业务存在不同分支，分支之间没有正相交，导致某一处的修改便会引入风险点；没有为业务准备合理、全面可行的单元测试，建立功能缺陷，导致系统运行风险增加。纷至沓来的技术债逐渐积累，积累到达临界点时，便会快速坍塌衰亡进入老年期，成为我们常说的“遗留系统”。繁重不堪，修改带来的收益远远小于风险，便无人敢动，只能说一句敬畏历史代码。</li></ul> <p>最近看了一个这样的<code>历史原因</code>、<code>遗留系统</code>标签的系统，在该系统上会经常发生各类生产事故，我称之为风险点的熵增爆发：</p> <ul><li>由于渠道名称命名无规范，经手人员随心所致。例如：一个渠道名称存在相同的业务含义，可以存在各类命名：<code>wechat</code>、<code>WeChat</code>、<code>WECHAT</code>。以至于后来判断逻辑上全部都得加上<code>StringUtils._equalsIgnoreCase_()</code>这荒唐的逻辑，再或者将其全部转换为大写。试问：统一的逻辑为什么不能抽象出更加职责单一的领域呢？</li> <li>重复代码的急剧上升。如果需求的功能数量与代码行数之间出现了不成比例的关系，可以说明该系统的健康体征出现了异常。例如：代码行数庞大，并不能说明该系统复杂，可能是得了<code>肥胖症</code>，存在大量重复代码。</li></ul> <p><img src="https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-08-09-130840.png" alt="image.png"></p> <h4 id="_2-2-结构"><a href="#_2-2-结构" class="header-anchor">#</a> 2.2 结构</h4> <p>同时，<strong>结构</strong>也是决定系统复杂度的一个关键因素。</p> <p>结构之所以复杂，多数情况下是我们系统的质量属性所决定的。</p> <p>例如：设计一个满足高性能、高并发需求的系统，你是否就需要考虑在系统中添加一系列中间件去满足该需求。引入缓存、并行处理、CDN、异步消息解耦削峰、异地容灾、分区可扩展。当然如果是一个海量数据进行处理，又得考虑数据如果分布式存储、如何多节点进行CPU内存高效利用执行，提高运算效率。</p> <p>如果系统是单体架构，需求简单、业务领域职责单一。同时单体架构一定比微服务架构更加简单便于维护，那为什么还需要这么微服务、服务网格架构呢？因此还是回到了上面提到的<code>质量属性</code></p> <p>无论设计是优雅还是拙劣，系统结构都会因为设计而变得复杂，其中唯一的区别是：前者是主动地控制结构复杂度，而后者的复杂度变化是偶发性的，是一种技术债的产生，会随着系统规模的增大而产生的一种<strong>无序设计</strong>。</p> <ul><li>代码没有显而易见的入口路径。</li> <li>不存在一致性，不存在风格，没有将各部分组织在一起的概念。系统当中的风格纯凭开发人员“喜好”、中间件使用方式也是“我想用这个中间件” ，“我在网上看到是这么使用的”，一盘散沙。</li> <li>系统中的控制流让人觉得不舒服，无法预测或难以预测。</li> <li>系统中有太多的“坏味道”，阅读代码时没有一种清新的感觉。</li> <li>数据很少放在它应该放在的地方，而是放在了更方便使用它的地方。例如：直接在业务中进行注入配置属性，应当引入统一、有规则、有结构的配置类进行一并管理。</li></ul> <p>一个无序的系统，就像隔着毛玻璃观察事物，其中各类元素都变得模糊不清，充斥着各种技术债，在负责需求维护的开发人员中击鼓传花，谁也不愿意做那个踩坑，偿还历史技术债的人。</p> <p>细节层面，代码浑浊不堪，违背了<strong>高内聚松耦合</strong>的设计原则，许多代码为了方便而方便，放错了位置；有些代码为了避免修改历史代码，“避免踩坑”，直接复制原有逻辑，直接出现新分支逻辑，导致大量重复代码块儿。</p> <p>架构层面，缺乏系统、业务清晰边界。各种通信组件、调用依赖组件、底层架构组件相互纠缠在一起，缺乏统一管理，一旦修改某一点时往往时牵一发动全身。同一问题空间的解决方案是各式各样，让人烟花缭乱，散发这开发人员自我的喜好风格。</p> <h3 id="_3-预测能力"><a href="#_3-预测能力" class="header-anchor">#</a> 3.预测能力</h3> <hr> <p>了解更多内容，可以关注我的微信公众号，更多首发文章。
<img src="https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-07-28-064228.bmp" alt="wechat"></p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h3 active"><a href="#_1-复杂系统" title="1.复杂系统">1.复杂系统</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2-理解能力" title="2.理解能力">2.理解能力</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-预测能力" title="3.预测能力">3.预测能力</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8><li class="contact-item" data-v-3d9deeb8><a href="https://github.com/ccoderJava" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-3d9deeb8><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-3d9deeb8></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8>鄂ICP备2021021487号-1</a></li></ul></div></footer></div><div class="global-ui"><!----><div class="my-popup" style="display:none;" data-v-3414bdeb><div class="my-popup-container" data-v-3414bdeb><div class="my-popup-exit" data-v-3414bdeb></div> <img src="" alt data-v-3414bdeb></div></div></div></div>
    <script src="/assets/js/app.7b778307.js" defer></script><script src="/assets/js/7.97c4f7f9.js" defer></script><script src="/assets/js/3.42bf2e6b.js" defer></script><script src="/assets/js/20.cae0dcf4.js" defer></script>
  </body>
</html>
