<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>策略模式与工厂模式实践 | 聪聪碎碎念</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="./favicon.ico">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-40YT5YJMBG" async="true"></script>
    <script> window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-40YT5YJMBG');</script>
    <script>var _hmt = _hmt || [];
               (function() {
                 var hm = document.createElement("script");
                 hm.src = "https://hm.baidu.com/hm.js?921719b1f1d6a98cb84343b54b11c7dd";
                 var s = document.getElementsByTagName("script")[0];
                 s.parentNode.insertBefore(hm, s);
               })();</script>
    <link rel="alternate" type="application/rss+xml" href="http://www.ccoder.cc/rss.xml" title="聪聪碎碎念 RSS Feed">
    <meta name="description" content="hello，大家好，我是聪聪。

[toc]

1.介绍

策略模式是一种行为设计模式， 它能让你定义一系列算法， 并将每种算法分别放入独立的类中， 以使算法的对象能够相互替换。

日常开发中，对于需要考虑各类场景、各类分支通用逻辑时，就需要考虑是否可以将if-else 、switch 逻辑替换成不同策略算法进行单独处理，提高代码的可读性、可维护性，避免代码混乱熵增 ...">
    <meta name="Keywords" content="ccoderJava,ccoder,聪聪的日志">
    
    <link rel="preload" href="/assets/css/0.styles.011b59ea.css" as="style"><link rel="preload" href="/assets/js/app.7b778307.js" as="script"><link rel="preload" href="/assets/js/7.97c4f7f9.js" as="script"><link rel="preload" href="/assets/js/3.42bf2e6b.js" as="script"><link rel="preload" href="/assets/js/26.1c1ea10b.js" as="script"><link rel="prefetch" href="/assets/js/10.531f4524.js"><link rel="prefetch" href="/assets/js/11.58aec4b6.js"><link rel="prefetch" href="/assets/js/12.24549026.js"><link rel="prefetch" href="/assets/js/13.7ca212e0.js"><link rel="prefetch" href="/assets/js/14.866271cf.js"><link rel="prefetch" href="/assets/js/15.b4f89f2c.js"><link rel="prefetch" href="/assets/js/16.554ad734.js"><link rel="prefetch" href="/assets/js/17.4c4bb8be.js"><link rel="prefetch" href="/assets/js/18.5b4cbac5.js"><link rel="prefetch" href="/assets/js/19.5523123d.js"><link rel="prefetch" href="/assets/js/20.cae0dcf4.js"><link rel="prefetch" href="/assets/js/21.6460c15b.js"><link rel="prefetch" href="/assets/js/22.1c7d6f32.js"><link rel="prefetch" href="/assets/js/23.13195399.js"><link rel="prefetch" href="/assets/js/24.41b250c4.js"><link rel="prefetch" href="/assets/js/25.95a8c30c.js"><link rel="prefetch" href="/assets/js/27.e3ff3995.js"><link rel="prefetch" href="/assets/js/28.4932824c.js"><link rel="prefetch" href="/assets/js/29.f7d5698d.js"><link rel="prefetch" href="/assets/js/30.93fd6aba.js"><link rel="prefetch" href="/assets/js/31.81151b77.js"><link rel="prefetch" href="/assets/js/32.6d8a4e2b.js"><link rel="prefetch" href="/assets/js/33.ed83d4b8.js"><link rel="prefetch" href="/assets/js/34.03576be8.js"><link rel="prefetch" href="/assets/js/35.65084bb6.js"><link rel="prefetch" href="/assets/js/36.0759daae.js"><link rel="prefetch" href="/assets/js/37.37caabf6.js"><link rel="prefetch" href="/assets/js/38.515763e2.js"><link rel="prefetch" href="/assets/js/39.04dd744d.js"><link rel="prefetch" href="/assets/js/4.a4c65c8f.js"><link rel="prefetch" href="/assets/js/40.0624546c.js"><link rel="prefetch" href="/assets/js/41.5bea29b8.js"><link rel="prefetch" href="/assets/js/42.2c1415b0.js"><link rel="prefetch" href="/assets/js/43.3d05244b.js"><link rel="prefetch" href="/assets/js/44.f3456612.js"><link rel="prefetch" href="/assets/js/45.772c60b6.js"><link rel="prefetch" href="/assets/js/46.ba97a1d0.js"><link rel="prefetch" href="/assets/js/47.f3ba6614.js"><link rel="prefetch" href="/assets/js/48.db14f4af.js"><link rel="prefetch" href="/assets/js/49.303ece5e.js"><link rel="prefetch" href="/assets/js/5.83f49348.js"><link rel="prefetch" href="/assets/js/50.48f0bbe8.js"><link rel="prefetch" href="/assets/js/51.fc7e32ab.js"><link rel="prefetch" href="/assets/js/52.da0c4e96.js"><link rel="prefetch" href="/assets/js/53.315f2104.js"><link rel="prefetch" href="/assets/js/54.2faba730.js"><link rel="prefetch" href="/assets/js/55.178970d9.js"><link rel="prefetch" href="/assets/js/6.80737f31.js"><link rel="prefetch" href="/assets/js/8.871b00b2.js"><link rel="prefetch" href="/assets/js/9.da852c59.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.a832fb5e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.011b59ea.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">聪聪碎碎念 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">文章</a></li><li class="nav-item"><a href="/notes/" class="nav-link">随笔</a></li><li class="nav-item"><a href="/tag/" class="nav-link">标签</a></li><li class="nav-item"><a href="https://ccoderjava.github.io/chencong_Java Development Engineer_5 years.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">个人简历</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">聪聪碎碎念 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">文章</a></li><li class="mobile-nav-item"><a href="/notes/" class="nav-link">随笔</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">标签</a></li><li class="mobile-nav-item"><a href="https://ccoderjava.github.io/chencong_Java Development Engineer_5 years.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">个人简历</a></li> <li class="mobile-nav-item"><a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        策略模式与工厂模式实践
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">聪聪</span> <!----></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2022-09-24T16:49:15.000Z">
      2022-09-24 04:49:15
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/strategy" data-v-42ccfcd5><span data-v-42ccfcd5>strategy</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/factory" data-v-42ccfcd5><span data-v-42ccfcd5>factory</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/设计模式" data-v-42ccfcd5><span data-v-42ccfcd5>设计模式</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>hello，大家好，我是聪聪。</p> <hr> <p>[toc]</p> <h2 id="_1-介绍"><a href="#_1-介绍" class="header-anchor">#</a> 1.介绍</h2> <p><strong>策略模式</strong>是一种行为设计模式， 它能让你定义一系列算法， 并将每种算法分别放入独立的类中， 以使算法的对象能够相互替换。</p> <p>日常开发中，对于需要考虑各类场景、各类分支通用逻辑时，就需要考虑是否可以将<code>if-else</code> 、<code>switch</code> 逻辑替换成不同策略算法进行单独处理，提高代码的可读性、可维护性，避免代码混乱熵增。</p> <p>这里简单介绍一下lambda替换策略模式的方式：</p> <ul><li>对于<code>Collections#sort()</code> 的排序方法，使用何种排序策略来自于<code>java.util.Comparator#compare()</code> 中定义。</li> <li><code>javax.servlet.http.HttpServlet#ser­vice­()</code>方法， 还有所有接受 <code>Http­Servlet­Request</code>和 <code>Http­Servlet­Response</code>对象作为参数的 do­XXX()方法。根据<code>HttpServletRequest.getMethod</code> 获取请求方式(GET、POST、PUT ...)，用以路由处理各类请求策略。</li></ul> <p>如何识别是否是策略模式：</p> <ul><li>通常策略模式可以通过允许嵌套对象完成实际工作的方法</li> <li>允许将该对象替换为不同对象的设置器来识别。</li></ul> <h2 id="_2-策略模式结构"><a href="#_2-策略模式结构" class="header-anchor">#</a> 2.策略模式结构</h2> <h3 id="_2-1-分支逻辑解释"><a href="#_2-1-分支逻辑解释" class="header-anchor">#</a> 2.1 分支逻辑解释</h3> <p>现在我们举个日常开发示例：</p> <p>让我们设计一个算费系统，当中有根据不同计费策略计算得到应收手续费。</p> <p>以下伪代码是最常的<code>if-else</code> <code>switch</code> 分支逻辑：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">BigDecimal</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span> amount<span class="token punctuation">,</span> <span class="token class-name">String</span> pricingModel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//单笔固定收费1元</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;fixed&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pricingModel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;1.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//百分比收费 2%</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;percent&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pricingModel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> amount<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0.02&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//固定值+百分比， 1+2%</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;fixedAndPercentage&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pricingModel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;1.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>amount<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0.02&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;暂不支持计费模式:&quot;</span> <span class="token operator">+</span> pricingModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BigDecimal</span> amount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//计算单笔固定收费</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">calculate</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span><span class="token string">&quot;fixed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//计算百分比收费</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">calculate</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span><span class="token string">&quot;percent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//计算固定值+百分比收费</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">calculate</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span><span class="token string">&quot;fixedAndPercentage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>上述逻辑已经根据计费模式<code>pricingModel</code> 来判断所属计算分支。看是仍然有以下弊端：</p> <ul><li>新增其他计费模式时，就需要修改<code>calculate</code> 方法，新增对应分支逻辑，导致整体方法持续增长、每次修改就绪全量回归。</li> <li>无法灵活适应变化的场景；各计费模式对应策略修改时，无法及时变更；
<ul><li>单笔固定收费从1元变更为5元需要及时修改逻辑，进行<code>hard coding</code></li> <li>出现营销活动时百分比计费需要灵活变更时，从2%修改为1%时同样需要修改逻辑，无法适应快速迭代的营销活动。</li></ul></li></ul> <p>下面将上述场景进行重构。</p> <h3 id="_2-2-策略模式设计"><a href="#_2-2-策略模式设计" class="header-anchor">#</a> 2.2 策略模式设计</h3> <p>首先看看策略模式应该是一个怎样的架构方式。</p> <p><img src="https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-09-24-055827.png" alt="image-20220924135826671"></p> <p>在这里我们需要做以下事情：</p> <ul><li>根据上述伪代码中<code>if-else</code> 逻辑进行拆分，抽象出一个同样的计费策略接口：<code>PricingStrategy</code></li> <li>一个执行上下文，用来创建特定计费策略对象，并且执行时将其引用替换为相关联的计费策略。<code>Context</code></li> <li>根据现有不同计费模式，实现计费策略接口进行不同计费模式的计算实现。</li></ul> <p>那直接上代码看看。</p> <h3 id="_2-3-策略模式代码"><a href="#_2-3-策略模式代码" class="header-anchor">#</a> 2.3 策略模式代码</h3> <h4 id="_2-3-1-通用策略接口及其各策略实现。"><a href="#_2-3-1-通用策略接口及其各策略实现。" class="header-anchor">#</a> 2.3.1 通用策略接口及其各策略实现。</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//通用的计费策略接口</span>
<span class="token keyword">interface</span> <span class="token class-name">PricingStrategy</span> <span class="token punctuation">{</span>
    <span class="token class-name">BigDecimal</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//固定计费模式</span>
<span class="token keyword">class</span> <span class="token class-name">FixedPricingStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">PricingStrategy</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;1.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//固定百分比计费</span>
<span class="token keyword">class</span> <span class="token class-name">PercentPricingStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">PricingStrategy</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>amount <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ZERO<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> amount<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0.02&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//固定值+百分比计费</span>
<span class="token keyword">class</span> <span class="token class-name">FixedAndPercentagePricingStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">PricingStrategy</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;1.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>amount<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0.02&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>代码解释：</p> <ul><li>一个通用策略接口 PricingStrategy</li> <li>各种策略算法实现方式：
<ul><li>固定值计费：FixedPricingStrategy</li> <li>百分比计费：PercentPricingStrategy</li> <li>固定值+百分比计费：FixedAndPercentagePricingStrategy</li></ul></li></ul> <h4 id="_2-3-2-执行上下文信息"><a href="#_2-3-2-执行上下文信息" class="header-anchor">#</a> 2.3.2 执行上下文信息</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//执行上下文：</span>
<span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//上下文会维护指向某个策略对象的引用</span>
    <span class="token keyword">private</span> <span class="token class-name">PricingStrategy</span> pricingStrategy<span class="token punctuation">;</span>

    <span class="token comment">// 上下文通常通过构造方法来设置策略</span>
    <span class="token keyword">public</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token class-name">PricingStrategy</span> pricingStrategy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pricingStrategy <span class="token operator">=</span> pricingStrategy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//也可以通过设置方法来切换策略</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPricingStrategy</span><span class="token punctuation">(</span><span class="token class-name">PricingStrategy</span> pricingStrategy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pricingStrategy <span class="token operator">=</span> pricingStrategy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 上下文会将一些工作委派给策略对象，而不是自行实现不同版本的算法。</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">executeStrategy</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> pricingStrategy<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>代码解释：</p> <ul><li>空构造器用以初始化上下文</li> <li>策略参数构造器用以初始化策略接口对象</li> <li>维护一个策略接口对象，用以后续指向具体策略算法实现</li> <li>策略对象委派执行到真实实现方法。</li></ul> <h4 id="_2-3-3-客户端调用"><a href="#_2-3-3-客户端调用" class="header-anchor">#</a> 2.3.3 客户端调用</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClientMain</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testConstructorCreation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//构造器方式指定策略</span>
        <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FixedPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> fixedResult <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">executeStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>fixedResult<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//切换策略</span>
        context<span class="token punctuation">.</span><span class="token function">setPricingStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PercentPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> percentResult <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">executeStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>percentResult<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testSetMethodCreation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//set设置方法设置策略和切换</span>
        <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//设置固定计费策略</span>
        context<span class="token punctuation">.</span><span class="token function">setPricingStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FixedPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> fixedResult <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">executeStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>fixedResult<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;1.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//设置百分比计费策略</span>
        context<span class="token punctuation">.</span><span class="token function">setPricingStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PercentPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> percentResult <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">executeStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>percentResult<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;2.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//设置固定值+百分比计费策略</span>
        context<span class="token punctuation">.</span><span class="token function">setPricingStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FixedAndPercentagePricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> fixedAndPercentResult <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">executeStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>fixedAndPercentResult<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;3.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ParameterizedTest</span>
    <span class="token annotation punctuation">@MethodSource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;allStrategy&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">testRouteStrategy</span><span class="token punctuation">(</span><span class="token class-name">String</span> strategy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;fixed&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>strategy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token function">setPricingStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FixedPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;percent&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>strategy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token function">setPricingStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PercentPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;fixedAndPercentage&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>strategy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token function">setPricingStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FixedAndPercentagePricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">BigDecimal</span> result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">executeStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//打印结果</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">allStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;fixed&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;percent&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fixedAndPercentage&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>上述测试方法很清晰：</p> <ul><li><code>testConstructorCreation</code> 通过构造器方式生成上下文，设定具体策略实现，同样后续可以通过set方法进行切换策略算法。</li> <li><code>testSetMethodCreation</code> 初始化空构造器方式生成上下文，通过set方法进行切换设置策略算法。</li> <li><code>routeStrategy</code> 初始化空构造器方式生成上下文，通过外部所传策略方法，进行路由具体策略算法实现。</li></ul> <h4 id="_2-3-4-总结"><a href="#_2-3-4-总结" class="header-anchor">#</a> 2.3.4 总结</h4> <p>上述策略模式重构相比于<code>if-else</code> <code>switch</code> 等分支逻辑已经结构化，相互解耦，减少维护成本。总结有以下优点：</p> <ul><li>策略算法可以自由切换，相互之间解耦。</li> <li>上下文可在运行时进行切换对象内的策略算法。</li> <li>扩展性好，新增其他策略算法时，实现通用算法策略接口即可。</li> <li>开闭原则，无需对上下文进行修改就能引入新的策略。</li></ul> <p>有有点，当然也有缺点：</p> <ul><li><p>策略算法较少时，没必要引入新的类、接口，增加程序复杂度。</p></li> <li><p>客户端必须知道所有的策略实现类，才能够通过上下文进行设置选择合适的策略。</p></li></ul> <p>那么，我们可以通过工厂模式+策略模式进行结构化、抽象此类策略算法的结构。在扩展中进行演示。</p> <h2 id="_3-常用示例"><a href="#_3-常用示例" class="header-anchor">#</a> 3.常用示例</h2> <p>上述策略模式的重构仍然可以有优化的余地：</p> <ul><li>各类策略可以定义枚举进行设定。</li> <li>通过工厂模式，客户端无需知道所有策略实现。</li></ul> <p>那我们直接上代码：</p> <h3 id="_3-1-定义一个策略枚举"><a href="#_3-1-定义一个策略枚举" class="header-anchor">#</a> 3.1 定义一个策略枚举</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">StrategyEnum</span> <span class="token punctuation">{</span>
    FIXED<span class="token punctuation">,</span>
    PERCENT<span class="token punctuation">,</span>
    FIXED_AND_PERCENTAGE<span class="token punctuation">;</span>

    <span class="token class-name">StrategyEnum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在该枚举中定义了所有策略类型，后续新增策略算法是进行扩展该枚举即可。</p> <h3 id="_3-2-策略接口增加servicecode"><a href="#_3-2-策略接口增加servicecode" class="header-anchor">#</a> 3.2 策略接口增加serviceCode</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PricingStrategy</span> <span class="token punctuation">{</span>
    <span class="token class-name">BigDecimal</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//每次一个策略接口实现均会实现该接口 用以标记策略实现的具体类型</span>
    <span class="token class-name">String</span> <span class="token function">getServiceCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>修改策略接口，增加<code>getServiceCode()</code> 方法。</p> <h3 id="_3-3-策略接口实现"><a href="#_3-3-策略接口实现" class="header-anchor">#</a> 3.3 策略接口实现</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//固定计费模式</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FixedPricingStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">PricingStrategy</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;1.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getServiceCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">StrategyEnum</span><span class="token punctuation">.</span>FIXED<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//固定百分比计费</span>
<span class="token keyword">class</span> <span class="token class-name">PercentPricingStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">PricingStrategy</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>amount <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ZERO<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> amount<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0.02&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getServiceCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">StrategyEnum</span><span class="token punctuation">.</span>PERCENT<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>策略实现类中均实现了<code>getServiceCode()</code> 接口，用以返回该策略实现类所属类型或服务编码，后续可以通过工厂模式进行生产获取该类型策略。</p> <h3 id="_3-4-策略工厂"><a href="#_3-4-策略工厂" class="header-anchor">#</a> 3.4 策略工厂</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PricingStrategyFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">PricingStrategyFactory</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PricingStrategy</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">init</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">PricingStrategy</span><span class="token punctuation">&gt;</span></span> pricingStrategyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PricingStrategy</span><span class="token punctuation">&gt;</span></span> strategyList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>strategyList <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PricingStrategy</span> strategy <span class="token operator">:</span> strategyList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> serviceCode <span class="token operator">=</span> strategy<span class="token punctuation">.</span><span class="token function">getServiceCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>serviceCode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Registration service code cannot be empty:%s&quot;</span><span class="token punctuation">,</span>
                        strategy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pricingStrategyMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>serviceCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                pricingStrategyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>serviceCode<span class="token punctuation">,</span> strategy<span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Registration service: {} , {}&quot;</span><span class="token punctuation">,</span> serviceCode<span class="token punctuation">,</span> strategy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Duplicate registration service: %s , %s , %s&quot;</span><span class="token punctuation">,</span>
                        serviceCode<span class="token punctuation">,</span> pricingStrategyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>serviceCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strategy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">PricingStrategy</span> <span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">String</span> serviceCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> pricingStrategyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>serviceCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>这里我们将所有计费策略实现全部存储在一个Map中进行初始化。</p> <p>通过策略接口中getServiceCode() 作为key进行存储，后续通过<code>getService(String serviceCode)</code> 即可获得对应的策略接口实现。</p> <h3 id="_3-5-使用方式"><a href="#_3-5-使用方式" class="header-anchor">#</a> 3.5 使用方式</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestStrategyFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">PricingStrategyFactory</span> pricingStrategyFactory<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@BeforeEach</span>
    <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PricingStrategy</span><span class="token punctuation">&gt;</span></span> strategyList <span class="token operator">=</span> <span class="token function">initPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pricingStrategyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PricingStrategyFactory</span><span class="token punctuation">(</span>strategyList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testFixedCalculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PricingStrategy</span> strategy <span class="token operator">=</span> pricingStrategyFactory<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">StrategyEnum</span><span class="token punctuation">.</span>FIXED<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> fixedResult <span class="token operator">=</span> strategy<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>fixedResult<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;1.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testPercentCalculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PricingStrategy</span> strategy <span class="token operator">=</span> pricingStrategyFactory<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">StrategyEnum</span><span class="token punctuation">.</span>PERCENT<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> percentResult <span class="token operator">=</span> strategy<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>percentResult<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;2.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 这里初始化所有PricingStrategy 接口的所有实现。</span>
    <span class="token comment">// 如果你是通过spring管理，直接通过@Autowrited即可注入得到List&lt;PricingStrategy&gt;</span>
    <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PricingStrategy</span><span class="token punctuation">&gt;</span></span> <span class="token function">initPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FixedPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PercentPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>上面使用方式就不过多解释了。注意初始化<code>PricingStrategyFactory</code> 的方式，此处只有一个构造器，需要注入策略接口的所有实现。</p> <p>如果你是用的是spring进行管理，那么直接可以通过<code>@Autowired</code> 的方式即可将所有接口实现进入注入，得到一个<code>List&lt;PricingStrategy&gt;</code> 。</p> <p>下面看看执行启动日志，可以很清晰的看到目前应用已注册多种策略：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Registration service: FIXED , class cc.ccoder.designpatterns.strategy.refactor.FixedPricingStrategy
Registration service: PERCENT , class cc.ccoder.designpatterns.strategy.refactor.PercentPricingStrategy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当然如果你有多个平行的策略时，都需要这样创建一个工厂，岂不是重复的逻辑又增加了。</p> <p>是否有一种优雅的方式进行工厂方法复用呢？</p> <p>上述将策略接口实现类放入Map中、从Map中通过serviceCode获取对应策略接口实现的逻辑应该是一致的，我们便可将其进行抽象出来。</p> <h2 id="_4-策略模式和工厂模式组合"><a href="#_4-策略模式和工厂模式组合" class="header-anchor">#</a> 4. 策略模式和工厂模式组合</h2> <ul><li>定义一个高度抽象的接口，提供serviceCode方法即可。</li> <li>定义一个策略接口的工厂接口，提供对应的策略方法。</li> <li>定义一个抽象的工厂方法，用以将策略接口方法放入Map，通过serviceCode获取对应策略接口。</li></ul> <p>以上便是我们的需求，那么接下来就开始编码看看。</p> <h3 id="_4-1-一个提供servicecode方法的接口"><a href="#_4-1-一个提供servicecode方法的接口" class="header-anchor">#</a> 4.1 一个提供serviceCode方法的接口</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CodeService</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 服务编码必须唯一
     *
     * @return 服务编码
     */</span>
    <span class="token class-name">String</span> <span class="token function">getServiceCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这是一个顶层接口，后续所有策略工厂模式接口均需要实现该接口，根据策略枚举内容进行返回。</p> <h3 id="_4-2-策略接口的工厂"><a href="#_4-2-策略接口的工厂" class="header-anchor">#</a> 4.2 策略接口的工厂</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CodeServiceFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span> <span class="token keyword">extends</span> <span class="token class-name">CodeService</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 获取服务
     *
     * @param serviceCode 服务编码
     * @return 返回服务，不存在时返回null
     */</span>
    <span class="token class-name">Provider</span> <span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">String</span> serviceCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这里限定了后续所有的策略提供者<code>Provider</code> 均需要继承于<code>CodeService</code> 接口。</p> <h3 id="_4-3-抽象的工厂方法"><a href="#_4-3-抽象的工厂方法" class="header-anchor">#</a> 4.3 抽象的工厂方法</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractCodeServiceFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span> <span class="token keyword">extends</span> <span class="token class-name">CodeService</span><span class="token punctuation">&gt;</span></span>
  <span class="token keyword">implements</span> <span class="token class-name">CodeServiceFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">AbstractCodeServiceFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Provider</span><span class="token punctuation">&gt;</span></span> serviceProviderMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token class-name">AbstractCodeServiceFactory</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span><span class="token punctuation">&gt;</span></span> providers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">initializeProviderMap</span><span class="token punctuation">(</span>providers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Initialize Factory Service
     *
     * @param providers 服务接口
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initializeProviderMap</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span><span class="token punctuation">&gt;</span></span> providers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Initialize Factory Service:{}&quot;</span><span class="token punctuation">,</span> <span class="token function">getFactoryName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>providers <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Provider</span> provider <span class="token operator">:</span> providers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> serviceCode <span class="token operator">=</span> provider<span class="token punctuation">.</span><span class="token function">getServiceCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>serviceCode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>
                        <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Registration service code cannot be empty :%s&quot;</span><span class="token punctuation">,</span> provider<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>serviceProviderMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>serviceCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                serviceProviderMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>serviceCode<span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Registered service: {}, {}&quot;</span><span class="token punctuation">,</span> serviceCode<span class="token punctuation">,</span> provider<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Duplicate registration service: %s, %s, %s&quot;</span><span class="token punctuation">,</span>
                        serviceCode<span class="token punctuation">,</span> serviceProviderMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>serviceCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> provider<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取服务 服务接口不存在时返回null
     *
     * @param serviceCode 服务编码
     * @return 服务接口c
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Provider</span> <span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">String</span> serviceCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> serviceProviderMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>serviceCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 服务工厂名称
     *
     * @return 工厂名称用于日志
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">getFactoryName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><p>将上述逻辑抽象到一个抽象工厂中，后续策略工厂便可通用。</p> <ul><li><code>getService()</code>方法，获取<code>serviceCode</code> 对应的策略接口提供者。</li> <li><code>getFactoryName()</code> 方法，底层工厂方法需实现，用以区分各个策略工厂。</li></ul> <p>那么问题来了？</p> <p>如何使用这样一个抽象工厂+策略模式的组合呢？</p> <p>那么现在我们有既定的计费策略需要实现，同时还增加了根据支付方式不同路由到不同的渠道进行支付的场景。</p> <p>就需要有以下两个策略场景</p> <ul><li>计费策略进行算费</li> <li>支付方式策略进行路由渠道。</li></ul> <h3 id="_4-4-使用方式"><a href="#_4-4-使用方式" class="header-anchor">#</a> 4.4 使用方式</h3> <h4 id="_4-4-1-计费策略工厂"><a href="#_4-4-1-计费策略工厂" class="header-anchor">#</a> 4.4.1 计费策略工厂</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PricingStrategyFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCodeServiceFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PricingStrategy</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">PricingStrategyFactory</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PricingStrategy</span><span class="token punctuation">&gt;</span></span> pricingStrategies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>pricingStrategies<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">getFactoryName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;计费策略工厂&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>实现顶层抽象工厂模板即可。</p> <p>构造方式初始化所有该策略算法的实现。</p> <p>如果你是spring管理，直接将该工厂进行<code>@Component</code> 管理即可使用。</p> <h4 id="_4-4-2-资金支付工厂"><a href="#_4-4-2-资金支付工厂" class="header-anchor">#</a> 4.4.2 资金支付工厂</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FundServiceFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCodeServiceFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FundService</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">FundServiceFactory</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FundService</span><span class="token punctuation">&gt;</span></span> fundServiceList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>fundServiceList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">getFactoryName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;资金支付工厂&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_4-4-3-客户端使用"><a href="#_4-4-3-客户端使用" class="header-anchor">#</a> 4.4.3 客户端使用</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestAbstractStrategyFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">FundServiceFactory</span> fundServiceFactory<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">PricingStrategyFactory</span> pricingStrategyFactory<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@BeforeEach</span>
    <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fundServiceFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FundServiceFactory</span><span class="token punctuation">(</span><span class="token function">initFundService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pricingStrategyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PricingStrategyFactory</span><span class="token punctuation">(</span><span class="token function">initPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testFixedCalculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PricingStrategy</span> strategy <span class="token operator">=</span> pricingStrategyFactory<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">StrategyEnum</span><span class="token punctuation">.</span>FIXED<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> fixedResult <span class="token operator">=</span> strategy<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>fixedResult<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;1.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testPercentCalculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PricingStrategy</span> strategy <span class="token operator">=</span> pricingStrategyFactory<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">StrategyEnum</span><span class="token punctuation">.</span>PERCENT<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> percentResult <span class="token operator">=</span> strategy<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>percentResult<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;2.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testFundServiceAlipay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FundService</span> service <span class="token operator">=</span> fundServiceFactory<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">ThirdPayChannel</span><span class="token punctuation">.</span>ALIPAY<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token string">&quot;pay parameters&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token class-name">ThirdPayChannel</span><span class="token punctuation">.</span>ALIPAY<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testFundServiceWeChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FundService</span> service <span class="token operator">=</span> fundServiceFactory<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">ThirdPayChannel</span><span class="token punctuation">.</span>WECHAT<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token string">&quot;pay parameters&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token class-name">ThirdPayChannel</span><span class="token punctuation">.</span>WECHAT<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 这里初始化所有PricingStrategy 接口的所有实现。</span>
    <span class="token comment">// 如果你是通过spring管理，直接通过@Autowrited即可注入得到List&lt;PricingStrategy&gt;</span>
    <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PricingStrategy</span><span class="token punctuation">&gt;</span></span> <span class="token function">initPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FixedPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PercentPricingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//如上所示</span>
    <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FundService</span><span class="token punctuation">&gt;</span></span> <span class="token function">initFundService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WeChatFundService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AliPayFundService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>通过设计模式中各类模式的组装、演变可以让我们在系统设计、代码架构方面能力得到提升。</p> <p>切记：</p> <p><strong>不可有了锤子，遍地都是钉子。</strong></p> <h2 id="_5-参考资料"><a href="#_5-参考资料" class="header-anchor">#</a> 5. 参考资料</h2> <ul><li><p><a href="https://refactoringguru.cn/design-patterns/strategy" target="_blank" rel="noopener noreferrer">策略模式：https://refactoringguru.cn/design-patterns/strategy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://tech.meituan.com/2022/03/10/interesting-talk-about-design-patterns.html" target="_blank" rel="noopener noreferrer">设计模式二三事情：https://tech.meituan.com/2022/03/10/interesting-talk-about-design-patterns.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>[2] 弗里曼. Head First 设计模式 [M]. 中国电力出版社, 2007.</p></li></ul> <p>最后的最后。</p> <p>以上所有涉及源码均会在GitHub进行同步更新。欢迎follow and star。</p> <p><a href="https://github.com/ccoderJava/designpatterns" target="_blank" rel="noopener noreferrer">https://github.com/ccoderJava/designpatterns<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>全文完。</p> <hr> <p>了解更多内容，可以关注我的微信公众号，更多首发文章。
<img src="https://ccoder-markdown-oss.oss-cn-shanghai.aliyuncs.com/md/2022-09-27-031343.png" alt="wechat"></p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#_1-介绍" title="1.介绍">1.介绍</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#_2-策略模式结构" title="2.策略模式结构">2.策略模式结构</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2-1-分支逻辑解释" title="2.1 分支逻辑解释">2.1 分支逻辑解释</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2-2-策略模式设计" title="2.2 策略模式设计">2.2 策略模式设计</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2-3-策略模式代码" title="2.3 策略模式代码">2.3 策略模式代码</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#_3-常用示例" title="3.常用示例">3.常用示例</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-1-定义一个策略枚举" title="3.1 定义一个策略枚举">3.1 定义一个策略枚举</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-2-策略接口增加servicecode" title="3.2 策略接口增加serviceCode">3.2 策略接口增加serviceCode</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-3-策略接口实现" title="3.3 策略接口实现">3.3 策略接口实现</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-4-策略工厂" title="3.4 策略工厂">3.4 策略工厂</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-5-使用方式" title="3.5 使用方式">3.5 使用方式</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#_4-策略模式和工厂模式组合" title="4. 策略模式和工厂模式组合">4. 策略模式和工厂模式组合</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-1-一个提供servicecode方法的接口" title="4.1 一个提供serviceCode方法的接口">4.1 一个提供serviceCode方法的接口</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-2-策略接口的工厂" title="4.2 策略接口的工厂">4.2 策略接口的工厂</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-3-抽象的工厂方法" title="4.3 抽象的工厂方法">4.3 抽象的工厂方法</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-4-使用方式" title="4.4 使用方式">4.4 使用方式</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#_5-参考资料" title="5. 参考资料">5. 参考资料</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8><li class="contact-item" data-v-3d9deeb8><a href="https://github.com/ccoderJava" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-3d9deeb8><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-3d9deeb8></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8>鄂ICP备2021021487号-1</a></li></ul></div></footer></div><div class="global-ui"><!----><div class="my-popup" style="display:none;" data-v-3414bdeb><div class="my-popup-container" data-v-3414bdeb><div class="my-popup-exit" data-v-3414bdeb></div> <img src="" alt data-v-3414bdeb></div></div></div></div>
    <script src="/assets/js/app.7b778307.js" defer></script><script src="/assets/js/7.97c4f7f9.js" defer></script><script src="/assets/js/3.42bf2e6b.js" defer></script><script src="/assets/js/26.1c1ea10b.js" defer></script>
  </body>
</html>
